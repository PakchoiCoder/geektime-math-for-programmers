# 47 | 搜索引擎（上）：如何通过倒排索引和向量空间模型，打造一个简单的搜索引擎？

## 设计搜索引擎

文本搜索系统通常包括两个重要模块：离线预处理 和 在线查询。

离线预处理主要包括数据获取、文本预处理、词典和倒排索引的构建、相关性模型的数据统计。其中文本预处理和倒排索引构建这两个步骤，无论在何种应用场景之中都是必不可少，是离线阶段的核心。常规的文本预处理是指针对文本进行粉刺、移除停用词、取词干、归一化、扩充同义词和近义词等操作。

倒排索引，就是将文档集合转换为从关键词到文档的这种查找关系。通过倒排，就可以很高效的根据给定的单词，找到出现过这个单词的文档集合。是典型的牺牲空间换取时间的方法。

在线查询就相对简单，一般会使用离线模块一样的预处理，拆解出来关键词等，然后在倒排索引中快速检出文档，进行相关性的计算。不同的相关性模型，有不同的计算方式。最简单的布尔模型只需要计算若干匹配条件的交集，向量空间模型 VSM，则需要计算查询向量和待查文档向量的余弦夹角，而语言模型需要计算匹配条件的贝叶斯概率等等。

## 倒排索引的设计

### 倒排索引里面具体存储什么内容

可以用哈希表，基于链式地址法的哈希表来实现。哈希的 key 为关键词此条，值是一个链表，链表的内容是所有文档的集合，每个节点表示一篇文档，每个 item 需要包含以下信息：

- ID 表示文档 ID
- tf 表示词频
- tfidf 表示词频-逆文档频率
- prob 表示这个词条在这篇文档中出现的条件概率

### 多个关键词的查询结果如何取交集

获取每个词条对应的所有文章，然后进行去重、排序，优先获取两边都匹配命中的。

## 向量空间和倒排索引的结合

向量空间模型假设所有的对象都可以转化为向量，然后使用向量间的距离（通常是欧式距离）或者是向量间的夹角余弦来表示两个对象之间的相似程度。

但是计算量会很大。通过倒排索引，我们可以挑选出那些出现过查询关键词的文档，并仅仅针对这些文档进行夹角余弦的计算，那么计算量就会大大减少。
