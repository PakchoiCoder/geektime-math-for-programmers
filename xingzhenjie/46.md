# 46 | 缓存系统：如何通过哈希表和队列实现高效访问？

离散数学是基础数据结构和编程算法的基石，而概率统计论和线性代数，是很多信息检索和机器学习算法的核心。

## 什么是缓存系统？

缓存是计算机系统里非常重要的发明之一，它在编程领域有非常非常多的应用。

缓存定义为数据交换的缓冲区。它的读取速度远远高于普通存储介质，可以帮助系统更快地运行。当某个应用需要读取数据时，会优先从缓存中查找需要的内容，如果找到了则直接获取，这个效率要比读取普通存储更高。如果缓存中没有发现需要的内容，再到普通存储中寻找。

缓存设计的几个主要考量因素：

* 第一因素是**硬件的性能**。
* 第二因素是**命中率**。
* 第三因素是**更新周期**。


## 如何设计一个缓存系统？

用哈希表和队列，来设计一个基于最久未用LRU策略的缓存。

首先需要确认某个被请求的数据，是不是存在于缓存系统中。通过哈希值计算快速定位，加快查找的速度。不论哈希表中有多少数据，读取，插入和删除操作只需要耗费接近常量的时间，也就是O(1)的时间复杂度，这正好满足了缓存高速运作的需求。

用数组和链表来构造哈希表。哈希表的实现采用的是链地址哈希表。这种方法的主要思想，先分配一个很大的数组空间，而数组中的每一个元素都是一个链表的头部。根据哈希函数算出的哈希值（也叫哈希的key），找到数组的某个元素及对应的链表，然后把数据添加到这个链表中。之所以要这样设计，是因为存在哈希冲突。尽量找到一个合理的哈希函数，减少冲突发生的机会，提升检索的效率。

缓存淘汰的策略。使用LRU最久未用策略。系统会根据数据最近一次的使用时间来排序，使用时间最久远的对象会被淘汰。考虑到这个特性，可以使用队列。队列是一宗先进先出的数据结构，先进先进入队列的元素会优先得到处理。如果充分利用队列的特点，就很容易找到上一次使用时间最久的数据，具体的实现过程如下：

* 第一，根据缓存的大小，设置队列的最大值。
* 第二，每次访问一个数据后，查看是不是已经存在一个队列中的结点对应于这个数据。
* 第三，如果队列已满，需要淘汰一些缓存中的数据。

*******








