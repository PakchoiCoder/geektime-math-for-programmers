# 06 | 递归（下）：分而治之，从归并排序到MapReduce

## 归并排序中的分治思想

归并排序算法的核心就是“归并”，也就是把两个有序的数列合并起来，形成一个更大的有序数列。

分而治之，通常简称为分治。他的思想就是，将一个负责的问题，分解成两个甚至多个规模相同或类似的子问题，然后对这些子问题再进一步细分，知道最后的子问题变得很简单，很容易就能被求解出来，这样这个复杂的问题就求解出来了。

归并和分治的思想结合起来，这其实就是归并排序算法。

归并排序使用了分治的思想，而这个过程需要使用递归来实现。

## 分布式系统中的分治思想

当需要排序的数组很大（达到1024G的时候），一台普通机器的内存无法计算，可以吧这个超级大的数据集，分解为多个更小的数据集（比如16G或者更小），然后分配到多台机器，让它们并行的处理。等待数据处理完，中央服务器再进行结果的合并。

### MapReduce是一种编程模型，用于大规模数据集（大于1TB）的并行运算。

#### 1. 数据分割和映射

分割是指将数据源进行切分，并将分片发送到Mapper上。映射是指Mapper根据应用的需求，将内容按照键-值的匹配，存储到哈希结构中。这两个步骤将大的数据集合切分为更小的数据集，降低了每台机器节点的负载，因此和分治中的问题类似。不过MapReduce采用了哈希映射来分配数据，而普通的分治或者递归不一定需要。

#### 2. 归约

归约是指接收到的一组简直配对，如果是键内容相同的配对，就将它们的值归并。这和本机的递归调用后返回结果的过程类似。不过，由于哈希映射的关系，MapReduce还需要洗牌的步骤，也就是将键-值的配对不断发给对应的Reduce进行归约。普通的分治或递归不一定需要洗牌的步骤。

#### 3. 合并

为了提升洗牌阶段的效率，可以选择减少发送到归约阶段的键-值配对。具体做法是在数据映射和洗牌之间，加入合并的过程，在每个Mapper节点上先进行一次本地的归约。然后只将合并的结果发送到洗牌和归约阶段。这和本机的递归调用后返回结果的过程类似。

**分治主要就是用在将复杂问题转化为若干个规模相当的小问题上。分治思想通常包括问题的细分 和结果的合并，正好对应于递归编程的函数嵌套调用和函数结果的返回。细分后的问题交给嵌套调用的函数去解决，而结果合并之后交由函数进行返回。所以，分治问题适合使用递归来实现。同时，分治的思想也可以帮助我们设计分布式系统和并行计算，细分后的问题交给不同的机器来处理，而其中的某些机器专门负责收集来自不同机器的处理结果，完成结果的合并。**

******

递归采用了和数学归纳法类似的思想，但是它用的是逆向递推，化繁为简，把复杂的问题逐步简化。再加上分治原理，就可以更有效的把问题细分，进行并行化处理。

而计算机编程中的函数嵌套调用，正好对应了数学中递归的逆向递推，所以只明白了数学递推式，就能非常容易的写出对应的递归编码。

